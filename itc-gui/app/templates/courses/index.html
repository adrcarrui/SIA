{% extends "base.html" %}
{% block content %}

<div class="d-flex align-items-center justify-content-between mb-3">
  <h2 class="mb-0">Courses</h2>
  <div class="d-flex align-items-center gap-2">
    <form class="d-flex" method="get" action="{{ url_for('courses.index') }}">
      <input name="q" value="{{ q or '' }}" class="form-control form-control-sm me-2" placeholder="Search course...">
      <button class="btn btn-sm btn-outline-primary ms-2">ğŸ”</button>
    </form>
    <a class="btn btn-sm btn-primary" href="{{ url_for('courses.new_course') }}">New course</a>
  </div>
</div>

<div class="table-responsive">
  <table class="table table-sm align-middle">
    <thead class="table-light">
      <tr>
        <th style="width:70px;">ID</th>
        <th>Course</th>
        <th>Name</th>
        <th>Client</th>
        <th>Start</th>
        <th>End</th>
        <th>Status</th>
        <th>Trainees</th>
        <th>Notes</th>
        <th style="width:150px;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for c in courses %}
      <tr>
        <td class="text-muted">{{ c.id }}</td>
        <td>{{ c.course or 'â€”'}}</td>
        <td>{{ c.name or 'â€”' }}</td>
        <td>{{ c.client or 'â€”' }}</td>
        <td class="text-nowrap">
          {{ c.start_date if c.start_date is not none else 'â€”' }}
        </td>
        <td class="text-nowrap">
          {{ c.end_date if c.end_date is not none else 'â€”' }}
        </td>
        <td>
          {% set status_color = {
            'active':'success',
            'finished':'secondary',
            'lost':'warning',
            'cancelled':'danger',
            'planned':"dark"
          }.get((c.auto_status or '')|lower, 'light') %}
          <span class="badge text-bg-{{ status_color }}">{{ c.auto_status or 'â€”' }}</span>
        </td>
        <td>{{ c.trainees }}</td>
        <td class="text-truncate" style="max-width:260px;">
          {{ c.notes if c is defined and c.notes is not none else '' }}
        </td>
        <td class="text-end">
          <div class="d-flex align-items-center gap-2">
                  <a href="{{ url_for('assignments.new_bulk', course_id=c.id) }}"
                class="btn btn-sm btn-primary">
                Associate
              </a>
            <a href="{{ url_for('courses.edit_course', course_id=c.id) }}" class="btn btn-secondary btn-sm">Edit</a>
            <form action="{{ url_for('courses.delete_course', course_id=c.id) }}" method="post" onsubmit="return confirm('Â¿Delete course #{{ c.id }}?');">
              <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
          </div>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="6" class="text-center text-muted py-4">
          {% if q %}No hay resultados para â€œ{{ q }}â€.{% else %}No hay cursos registrados.{% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
  <nav aria-label="PaginaciÃ³n">
    <ul class="pagination">
      <li class="page-item {% if not has_prev %}disabled{% endif %}">
        <a class="page-link" href="{{ url_for('courses.index', q=q, page=(page-1 if page>1 else 1), per_page=per_page) }}">Â«</a>
      </li>
      <li class="page-item active"><span class="page-link">{{ page }}</span></li>
      <li class="page-item {% if not has_next %}disabled{% endif %}">
        <a class="page-link" href="{{ url_for('courses.index', q=q, page=(page+1 if has_next else page), per_page=per_page) }}">Â»</a>
      </li>
    </ul>
  </nav>

{% endblock %}
