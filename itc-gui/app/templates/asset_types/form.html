{% extends "base.html" %}
{% block content %}

<h2 class="mb-3">{{ page_title }}</h2>

<form method="post">
  {% if csrf_token is defined %}
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  {% endif %}

  <div class="row g-3">

    <div class="col-md-4">
      <label class="form-label">Code</label>
      <input class="form-control" name="code" required
             value="{{ asset_type.code if asset_type else '' }}"
             placeholder="CARD_VENDING">
      <div class="form-text">Se normaliza a MAYÃšSCULAS y _</div>
    </div>

    <div class="col-md-8">
      <label class="form-label">Name</label>
      <input class="form-control" name="name" required
             value="{{ asset_type.name if asset_type else '' }}"
             placeholder="Vending">
    </div>

    <div class="col-md-6">
      <label class="form-label">Parent (root type)</label>
      <select class="form-select" name="parent_id">
        <option value="">(None) Root type</option>
        {% for r in roots %}
          {# si editas, evita poder elegirte a ti mismo #}
          {% if not asset_type or r.id != asset_type.id %}
            <option value="{{ r.id }}"
              {{ 'selected' if asset_type and asset_type.parent_id == r.id else '' }}>
              {{ r.name }} ({{ r.code }})
            </option>
          {% endif %}
        {% endfor %}
      </select>
      <div class="form-text">Si eliges parent, esto es un subtipo.</div>
    </div>

    <div class="col-md-6">
      <label class="form-label">Managed by</label>
      <select class="form-select" name="managed_by_department" required>
        {% for dep in DEPARTMENTS %}
          <option value="{{ dep }}"
            {{ 'selected' if asset_type and asset_type.managed_by_department == dep else '' }}>
            {{ dep }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-2">
      <label class="form-label">Sort</label>
      <input class="form-control" name="sort_order" type="number"
             value="{{ asset_type.sort_order if asset_type else 0 }}">
    </div>

    <div class="col-md-10 d-flex align-items-end gap-4">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="requires_rfid" id="requires_rfid"
          {{ 'checked' if asset_type and asset_type.requires_rfid else '' }}>
        <label class="form-check-label" for="requires_rfid">Requires RFID</label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="requires_barcode" id="requires_barcode"
          {{ 'checked' if asset_type and asset_type.requires_barcode else '' }}>
        <label class="form-check-label" for="requires_barcode">Requires barcode</label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="show_in_calendar" id="show_in_calendar"
          {{ 'checked' if (asset_type and asset_type.show_in_calendar) or (not asset_type) else '' }}>
        <label class="form-check-label" for="show_in_calendar">Show in calendar</label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="active" id="active"
          {{ 'checked' if (asset_type and asset_type.active) or (not asset_type) else '' }}>
        <label class="form-check-label" for="active">Active</label>
      </div>
    </div>

  </div>

  <div class="mt-4 d-flex justify-content-end gap-2">
    <button class="btn btn-primary" type="submit">Save</button>
    <a class="btn btn-secondary" href="{{ url_for('asset_types.index') }}">Cancel</a>
  </div>
</form>

{% endblock %}
